{"version":3,"sources":["../src/main.ts"],"names":[],"mappings":"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","sourcesContent":["import { CancellationToken, PackageFileInfo, ProgressInfo, UpdateFileInfo, UpdateInfo } from \"builder-util-runtime\"\r\nimport { EventEmitter } from \"events\"\r\nimport { URL } from \"url\"\r\nimport { AppUpdater } from \"./AppUpdater\"\r\nimport { LoginCallback } from \"./electronHttpExecutor\"\r\n\r\nexport { AppUpdater, NoOpLogger } from \"./AppUpdater\"\r\nexport { UpdateInfo }\r\nexport { CancellationToken } from \"builder-util-runtime\"\r\nexport { Provider } from \"./providers/Provider\"\r\n\r\n// autoUpdater to mimic electron bundled autoUpdater\r\nlet _autoUpdater: any\r\n\r\n// required for jsdoc\r\nexport declare const autoUpdater: AppUpdater\r\n\r\nfunction _load_autoUpdater(): AppUpdater {\r\n  // tslint:disable:prefer-conditional-expression\r\n  if (process.platform === \"win32\") {\r\n    _autoUpdater = new (require(\"./NsisUpdater\").NsisUpdater)()\r\n  }\r\n  else if (process.platform === \"darwin\") {\r\n    _autoUpdater = new (require(\"./MacUpdater\").MacUpdater)()\r\n  }\r\n  else {\r\n    _autoUpdater = new (require(\"./AppImageUpdater\").AppImageUpdater)()\r\n  }\r\n  return _autoUpdater\r\n}\r\n\r\nObject.defineProperty(exports, \"autoUpdater\", {\r\n  enumerable: true,\r\n  get: () => {\r\n    return _autoUpdater || _load_autoUpdater()\r\n  }\r\n})\r\n\r\nexport interface ResolvedUpdateFileInfo {\r\n  readonly url: URL\r\n  readonly info: UpdateFileInfo\r\n\r\n  packageInfo?: PackageFileInfo\r\n}\r\n\r\n// due to historical reasons for windows we use channel name without platform specifier\r\nexport function getDefaultChannelName() {\r\n  return `latest${getChannelFilePrefix()}`\r\n}\r\n\r\nfunction getChannelFilePrefix() {\r\n  const currentPlatform = getCurrentPlatform()\r\n  if (currentPlatform === \"linux\") {\r\n    const arch = process.env.TEST_UPDATER_ARCH || process.arch\r\n    const archSuffix = arch === \"x64\" ? \"\" : `-${arch}`\r\n    return \"-linux\" + archSuffix\r\n  }\r\n  else {\r\n    return currentPlatform === \"darwin\" ? \"-mac\" : \"\"\r\n  }\r\n}\r\n\r\nexport function getCustomChannelName(channel: string) {\r\n  return `${channel}${getChannelFilePrefix()}`\r\n}\r\n\r\nexport function getCurrentPlatform() {\r\n  return process.env.TEST_UPDATER_PLATFORM || process.platform\r\n}\r\n\r\nexport function isUseOldMacProvider() {\r\n  // getCurrentPlatform() === \"darwin\"\r\n  return false\r\n}\r\n\r\nexport function getChannelFilename(channel: string) {\r\n  return `${channel}.yml`\r\n}\r\n\r\nexport interface UpdateCheckResult {\r\n  readonly updateInfo: UpdateInfo\r\n\r\n  readonly downloadPromise?: Promise<Array<string>> | null\r\n\r\n  readonly cancellationToken?: CancellationToken\r\n\r\n  /** @deprecated */\r\n  readonly versionInfo: UpdateInfo\r\n}\r\n\r\nexport type UpdaterEvents = \"login\" | \"checking-for-update\" | \"update-available\" | \"update-cancelled\" | \"download-progress\" | \"update-downloaded\" | \"error\"\r\n\r\nexport const DOWNLOAD_PROGRESS: UpdaterEvents = \"download-progress\"\r\nexport const UPDATE_DOWNLOADED: UpdaterEvents = \"update-downloaded\"\r\n\r\nexport type LoginHandler = (authInfo: any, callback: LoginCallback) => void\r\n\r\nexport class UpdaterSignal {\r\n  constructor(private emitter: EventEmitter) {\r\n  }\r\n\r\n  /**\r\n   * Emitted when an authenticating proxy is [asking for user credentials](https://github.com/electron/electron/blob/master/docs/api/client-request.md#event-login).\r\n   */\r\n  login(handler: LoginHandler) {\r\n    addHandler(this.emitter, \"login\", handler)\r\n  }\r\n\r\n  progress(handler: (info: ProgressInfo) => void) {\r\n    addHandler(this.emitter, DOWNLOAD_PROGRESS, handler)\r\n  }\r\n\r\n  updateDownloaded(handler: (info: UpdateInfo) => void) {\r\n    addHandler(this.emitter, UPDATE_DOWNLOADED, handler)\r\n  }\r\n\r\n  updateCancelled(handler: (info: UpdateInfo) => void) {\r\n    addHandler(this.emitter, \"update-cancelled\", handler)\r\n  }\r\n}\r\n\r\nconst isLogEvent = false\r\n\r\nfunction addHandler(emitter: EventEmitter, event: UpdaterEvents, handler: (...args: Array<any>) => void) {\r\n  if (isLogEvent) {\r\n    emitter.on(event, (...args: Array<any>) => {\r\n      console.log(\"%s %s\", event, args)\r\n      handler.apply(null, args)\r\n    })\r\n  }\r\n  else {\r\n    emitter.on(event, handler)\r\n  }\r\n}\r\n\r\nexport interface Logger {\r\n  info(message?: any): void\r\n\r\n  warn(message?: any): void\r\n\r\n  error(message?: any): void\r\n\r\n  debug?(message: string): void\r\n}\r\n\r\n// if baseUrl path doesn't ends with /, this path will be not prepended to passed pathname for new URL(input, base)\r\n/** @internal */\r\nexport function newBaseUrl(url: string) {\r\n  const result = new URL(url)\r\n  if (!result.pathname.endsWith(\"/\")) {\r\n    result.pathname += \"/\"\r\n  }\r\n  return result\r\n}\r\n\r\n// addRandomQueryToAvoidCaching is false by default because in most cases URL already contains version number,\r\n// so, it makes sense only for Generic Provider for channel files\r\nexport function newUrlFromBase(pathname: string, baseUrl: URL, addRandomQueryToAvoidCaching: boolean = false): URL {\r\n  const result = new URL(pathname, baseUrl)\r\n  // search is not propagated (search is an empty string if not specified)\r\n  const search = baseUrl.search\r\n  if (search != null && search.length !== 0) {\r\n    result.search = search\r\n  }\r\n  else if (addRandomQueryToAvoidCaching) {\r\n    result.search = `noCache=${Date.now().toString(32)}`\r\n  }\r\n  return result\r\n}\r\n"],"sourceRoot":""}
